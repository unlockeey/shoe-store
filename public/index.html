<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Shoe Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 100%; padding: 20px; }
        .header { text-align: center; background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h1 { color: #2481cc; margin-bottom: 10px; }
        .mpesa-badge { background: #48c446; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; display: inline-block; margin-top: 10px; }
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .product-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .product-image { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; background: #e0e0e0; }
        .product-name { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .product-price { color: #2481cc; font-weight: bold; font-size: 16px; margin-bottom: 10px; }
        .add-to-cart { width: 100%; background: #2481cc; color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .add-to-cart:active { transform: scale(0.98); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #e0e0e0; }
        .nav-btn { flex: 1; padding: 12px; background: #2481cc; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .nav-btn.cart { background: #ff9500; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ‘Ÿ Smart Shoe Store</h1>
            <p>Quality shoes with M-Pesa payments</p>
            <div class="mpesa-badge">M-Pesa Till: 6956976</div>
        </div>
        
        <div id="productsGrid" class="products-grid">
            <div class="loading">Loading products...</div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn cart" onclick="showCart()">ðŸ›’ View Cart</button>
        <button class="nav-btn" onclick="checkout()">ðŸ’³ Checkout</button>
    </div>

    <script>
        const API_URL = window.location.origin + '/api';
        let cart = [];
        
        async function loadProducts() {
            try {
                const response = await fetch(API_URL + '/products');
                const result = await response.json();
                
                if (result.success) {
                    displayProducts(result.data);
                }
            } catch (error) {
                document.getElementById('productsGrid').innerHTML = '<div class="loading">Error loading products</div>';
            }
        }
        
        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">KES ${product.price}</div>
                    <button class="add-to-cart" onclick="addToCart(${product.id})">Add to Cart</button>
                </div>
            `).join('');
        }
        
        function addToCart(productId) {
            alert('Added to cart!');
            cart.push(productId);
            updateCartCount();
        }
        
        function updateCartCount() {
            const cartBtn = document.querySelector('.nav-btn.cart');
            cartBtn.textContent = `ðŸ›’ Cart (${cart.length})`;
        }
        
        function showCart() {
            alert(`You have ${cart.length} items in cart!\n\nProceed to checkout with M-Pesa Till: 6956976`);
        }
        
        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            alert(`ðŸš€ Ready to checkout!\n\nItems: ${cart.length}\nPay via M-Pesa Till: 6956976\n\nDelivery available nationwide!`);
        }
        
        // Initialize
        loadProducts();
        
        // Telegram Web App integration
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.expand();
            Telegram.WebApp.ready();
        }
    </script>
</body>
</html>
